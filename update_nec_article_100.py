import sys
import os

# Import directly from app
from app import create_app, db
from models import NECArticle

def update_nec_article():
    """Update or add NEC article 100 to the database."""
    # Article data
    article_data = {
        "article_number": "100",
        "title": "Definitions",
        "summary": "Article 100 provides definitions of terms used throughout the NEC. These definitions are essential for proper interpretation and application of the Code requirements.",
        "content": """<h3>Purpose and Scope</h3><p>Article 100 provides definitions for terms used throughout the National Electrical Code (NEC). These definitions establish the precise meaning of terminology used in the code, ensuring consistent interpretation and application. When a term is used in multiple articles with different meanings, the article-specific definition will be included in that article rather than in Article 100.</p><p>The definitions in Article 100 are organized into two parts:</p><ul><li><strong>Part I:</strong> Contains definitions that apply throughout the code</li><li><strong>Part II:</strong> Contains definitions that apply only to installations and equipment operating at over 1000 volts, nominal</li></ul><p>Understanding these definitions is fundamental to correctly interpreting and applying the requirements found in the rest of the NEC.</p><h3>Key General Definitions (Part I)</h3><p><strong>Accessible (as applied to equipment):</strong> Admitting close approach; not guarded by locked doors, elevation, or other effective means.</p><p><strong>Accessible (as applied to wiring methods):</strong> Capable of being removed or exposed without damaging the building structure or finish or not permanently closed in by the structure or finish of the building.</p><p><strong>Ampacity:</strong> The maximum current, in amperes, that a conductor can carry continuously under the conditions of use without exceeding its temperature rating.</p><p><strong>Approved:</strong> Acceptable to the authority having jurisdiction.</p><p><strong>Authority Having Jurisdiction (AHJ):</strong> An organization, office, or individual responsible for enforcing the requirements of a code or standard, or for approving equipment, materials, an installation, or a procedure.</p><p><strong>Branch Circuit:</strong> The circuit conductors between the final overcurrent device protecting the circuit and the outlet(s).</p><p><strong>Circuit Breaker:</strong> A device designed to open and close a circuit by nonautomatic means and to open the circuit automatically on a predetermined overcurrent without damage to itself when properly applied within its rating.</p><p><strong>Dwelling Unit:</strong> A single unit providing complete and independent living facilities for one or more persons, including permanent provisions for living, sleeping, cooking, and sanitation.</p><p><strong>Energized:</strong> Electrically connected to, or is, a source of voltage.</p><p><strong>Equipment:</strong> A general term, including fittings, devices, appliances, luminaires, apparatus, machinery, and the like, used as a part of, or in connection with, an electrical installation.</p><p><strong>Exposed (as applied to live parts):</strong> Capable of being inadvertently touched or approached nearer than a safe distance by a person.</p><p><strong>Feeder:</strong> All circuit conductors between the service equipment, the source of a separately derived system, or other power supply source and the final branch-circuit overcurrent device.</p><p><strong>Ground:</strong> The earth.</p><p><strong>Grounded (Grounding):</strong> Connected (connecting) to ground or to a conductive body that extends the ground connection.</p><p><strong>Grounded Conductor:</strong> A system or circuit conductor that is intentionally grounded.</p><p><strong>Grounding Conductor, Equipment (EGC):</strong> The conductive path(s) that provides a ground-fault current path and connects normally non-current-carrying metal parts of equipment together and to the system grounded conductor or to the grounding electrode conductor, or both.</p><p><strong>Grounding Electrode Conductor:</strong> A conductor used to connect the system grounded conductor or the equipment to a grounding electrode or to a point on the grounding electrode system.</p><p><strong>Identified (as applied to equipment):</strong> Recognizable as suitable for the specific purpose, function, use, environment, application, and so forth, where described in a particular code requirement.</p><p><strong>In Sight From (Within Sight From, Within Sight):</strong> Where this Code specifies that one equipment shall be "in sight from," "within sight from," or "within sight of," and so forth, another equipment, the specified equipment is to be visible and not more than 15 m (50 ft) distant from the other.</p><p><strong>Listed:</strong> Equipment, materials, or services included in a list published by an organization that is acceptable to the authority having jurisdiction and concerned with evaluation of products or services, that maintains periodic inspection of production of listed equipment or materials or periodic evaluation of services, and whose listing states that either the equipment, material, or service meets appropriate designated standards or has been tested and found suitable for a specified purpose.</p><p><strong>Luminaire:</strong> A complete lighting unit consisting of a light source such as a lamp or lamps, together with the parts designed to position the light source and connect it to the power supply.</p><p><strong>Neutral Conductor:</strong> The conductor connected to the neutral point of a system that is intended to carry current under normal conditions.</p><p><strong>Overcurrent:</strong> Any current in excess of the rated current of equipment or the ampacity of a conductor. It may result from overload, short circuit, or ground fault.</p><p><strong>Overload:</strong> Operation of equipment in excess of normal, full-load rating, or of a conductor in excess of rated ampacity that, when it persists for a sufficient length of time, would cause damage or dangerous overheating.</p><p><strong>Panelboard:</strong> A single panel or group of panel units designed for assembly in the form of a single panel, including buses and automatic overcurrent devices, and equipped with or without switches for the control of light, heat, or power circuits; designed to be placed in a cabinet or cutout box placed in or against a wall, partition, or other support; and accessible only from the front.</p><p><strong>Qualified Person:</strong> One who has skills and knowledge related to the construction and operation of the electrical equipment and installations and has received safety training to recognize and avoid the hazards involved.</p><p><strong>Raceway:</strong> An enclosed channel of metal or nonmetallic materials designed expressly for holding wires, cables, or busbars, with additional functions as permitted in this Code.</p><p><strong>Receptacle:</strong> A contact device installed at the outlet for the connection of an attachment plug, or for the direct connection of listed utilization equipment designed to mate with the corresponding contact device.</p><p><strong>Service:</strong> The conductors and equipment for delivering electric energy from the serving utility to the wiring system of the premises served.</p><p><strong>Service Equipment:</strong> The necessary equipment, usually consisting of a circuit breaker(s) or switch(es) and fuse(s) and their accessories, connected to the load end of service conductors to a building or other structure, or an otherwise designated area, and intended to constitute the main control and cutoff of the supply.</p><p><strong>Short-Circuit Current Rating:</strong> The prospective symmetrical fault current at a nominal voltage to which an apparatus or system is able to be connected without sustaining damage exceeding defined acceptance criteria.</p><p><strong>Switchboard:</strong> A large single panel, frame, or assembly of panels on which are mounted on the face, back, or both, switches, overcurrent and other protective devices, buses, and usually instruments.</p><p><strong>Voltage (of a circuit):</strong> The greatest root-mean-square (rms) (effective) difference of potential between any two conductors of the circuit concerned.</p><p><strong>Voltage, Nominal:</strong> A nominal value assigned to a circuit or system for the purpose of conveniently designating its voltage class (e.g., 120/240 volts, 480Y/277 volts, 600 volts).</p><h3>High-Voltage Definitions (Part II)</h3><p><strong>Cutout:</strong> An assembly of a fuse support with either a fuseholder, fuse carrier, or disconnecting blade. The fuseholder or fuse carrier may include a conducting element (fuse link), or may act as the disconnecting blade by the inclusion of a nonfusible member.</p><p><strong>High Voltage:</strong> For the purposes of the NEC, more than 1000 volts, nominal.</p><p><strong>Metal-Enclosed Power Switchgear:</strong> A switchgear assembly completely enclosed on all sides and top with sheet metal (except for ventilating openings and inspection windows) and containing primary power circuit switching or interrupting devices, or both, with buses and connections.</p><p><strong>Switching Device:</strong> A device designed to close, open, or both, one or more electric circuits.</p><h3>Practical Application of Definitions</h3><p>The definitions in Article 100 form the foundation for understanding and applying the NEC. When interpreting any code requirement, electricians, inspectors, and engineers should first refer to the definitions to ensure they are applying the correct meaning to the terms used.</p><p>For example, understanding the distinction between terms like "grounded conductor" (often the neutral, identified by white or gray color) and "grounding conductor" (typically equipment grounding conductors, identified by green or bare conductors) is essential for proper installation and safety.</p><p>Similarly, the definition of "identified" helps clarify when a component is suitable for a specific application, while "listed" refers to equipment that has been evaluated by a recognized testing laboratory and found suitable for its intended use.</p><h3>Changes in Recent Code Editions</h3><p>With each code cycle, Article 100 undergoes revisions to clarify existing definitions or add new terms that have become relevant due to evolving technologies or practices. For example, recent editions have added or refined definitions related to:</p><ul><li>Energy storage systems</li><li>Solar photovoltaic systems</li><li>Grounding and bonding terminology</li><li>Arc-flash protection</li><li>Coordination of electrical systems</li></ul><p>Staying current with these definitions is crucial for anyone working with the NEC, as changes to definitions can significantly impact the interpretation and application of requirements throughout the code.</p><h3>Common Misunderstandings</h3><p>Several definitions in Article 100 are commonly misunderstood or confused:</p><ul><li><strong>Accessible:</strong> The dual meanings (for equipment vs. wiring methods) often cause confusion.</li><li><strong>Ground vs. Grounded:</strong> "Ground" refers to the earth, while "grounded" refers to a connection to the earth or to a conducting body that extends the ground connection.</li><li><strong>Grounded Conductor vs. Grounding Conductor:</strong> A grounded conductor (often the neutral) normally carries current, while a grounding conductor (equipment grounding conductor) normally doesn't carry current except during a fault.</li><li><strong>Voltage, Nominal:</strong> Often misunderstood as the exact operating voltage, when it's actually a classification.</li></ul><p>Careful attention to the precise definitions in Article 100 is essential for proper code compliance and electrical safety. When in doubt about the meaning of a term, always refer back to the official definition rather than relying on common usage or assumptions.</p>"""
    }
    
    # Check if article exists
    existing_article = NECArticle.query.filter_by(
        article_number=article_data['article_number']
    ).first()
    
    if existing_article:
        # Update existing article
        existing_article.title = article_data['title']
        existing_article.summary = article_data['summary']
        existing_article.content = article_data['content']
        print(f"Updated Article {article_data['article_number']}: {article_data['title']}")
    else:
        # Create new article
        new_article = NECArticle(
            article_number=article_data['article_number'],
            title=article_data['title'],
            summary=article_data['summary'],
            content=article_data['content']
        )
        db.session.add(new_article)
        print(f"Added Article {article_data['article_number']}: {article_data['title']}")
    
    # Commit changes
    db.session.commit()
    
    return True

def main():
    """Create app context and run the update function."""
    try:
        app = create_app()
        with app.app_context():
            success = update_nec_article()
            if success:
                print(f"NEC article 100 update completed successfully.")
            else:
                print(f"NEC article 100 update failed.")
    except Exception as e:
        print(f"Error: {str(e)}")

if __name__ == "__main__":
    main() 