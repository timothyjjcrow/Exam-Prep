import sys
import os

# Import directly from app
from app import create_app, db
from models import NECArticle

def update_nec_articles_batch3():
    """Update or add NEC articles to the database (third batch)."""
    # List of updated NEC articles
    updated_articles = [
        {
            "article_number": "334",
            "title": "Nonmetallic-Sheathed Cable: Types NM, NMC, and NMS",
            "summary": "Requirements for nonmetallic-sheathed cable",
            "content": "<h3>Article 334: Nonmetallic-Sheathed Cable: Types NM, NMC, and NMS</h3><p>This article covers the use, installation, and construction specifications for nonmetallic-sheathed cable.</p><h4>Key Provisions:</h4><ul><li><strong>334.1 Scope:</strong> This article covers the use, installation, and construction specifications of nonmetallic-sheathed cable.</li><li><strong>334.2 Definitions:</strong> Defines Type NM, Type NMC, and Type NMS cables.</li><li><strong>334.6 Listed:</strong> Types NM, NMC, and NMS cables shall be listed.</li><li><strong>334.10 Uses Permitted:</strong> Lists where Types NM, NMC, and NMS cables are permitted to be used.</li><li><strong>334.12 Uses Not Permitted:</strong> Lists where Types NM, NMC, and NMS cables shall not be used.</li><li><strong>334.15 Exposed Work:</strong> In exposed work, except as provided in 300.11(A), the cable shall be installed as specified in certain subsections.</li><li><strong>334.17 Through or Parallel to Framing Members:</strong> Types NM, NMC, or NMS cable shall comply with 300.4 where installed through or parallel to framing members.</li><li><strong>334.23 In Accessible Attics:</strong> Types NM, NMC, and NMS cables in accessible attics or roof spaces shall be installed as specified in 320.23.</li><li><strong>334.24 Bending Radius:</strong> Bends in Types NM, NMC, and NMS cable shall be made so that the cable is not damaged, with the radius of the curve of the inner edge of any bend not less than five times the diameter of the cable.</li><li><strong>334.30 Securing and Supporting:</strong> Nonmetallic-sheathed cable shall be secured by staples, cable ties, straps, or similar fittings so designed and installed as not to damage the cable at intervals not exceeding 1.4 m (4 1⁄2 ft) and within 300 mm (12 in.) of every outlet box, junction box, cabinet, or fitting.</li><li><strong>334.40 Boxes and Fittings:</strong> Requirements for boxes and fittings used with nonmetallic-sheathed cable.</li><li><strong>334.80 Ampacity:</strong> The ampacity of Types NM, NMC, and NMS cable shall be determined in accordance with 310.15.</li></ul>"
        },
        {
            "article_number": "352",
            "title": "Rigid Polyvinyl Chloride Conduit: Type PVC",
            "summary": "Requirements for rigid PVC conduit",
            "content": "<h3>Article 352: Rigid Polyvinyl Chloride Conduit: Type PVC</h3><p>This article covers the use, installation, and construction specifications for rigid polyvinyl chloride conduit (PVC) and associated fittings.</p><h4>Key Provisions:</h4><ul><li><strong>352.1 Scope:</strong> This article covers the use, installation, and construction specifications for rigid polyvinyl chloride conduit (PVC) and associated fittings.</li><li><strong>352.2 Definition:</strong> Defines rigid polyvinyl chloride conduit (PVC).</li><li><strong>352.6 Listing Requirements:</strong> PVC conduit, factory elbows, and associated fittings shall be listed.</li><li><strong>352.10 Uses Permitted:</strong> Lists where PVC conduit is permitted to be used.</li><li><strong>352.12 Uses Not Permitted:</strong> Lists where PVC conduit shall not be used.</li><li><strong>352.20 Size:</strong> PVC conduit shall be permitted in trade sizes 1⁄2 through 6.</li><li><strong>352.22 Number of Conductors:</strong> The number of conductors shall not exceed that permitted by the percentage fill specified in Table 1, Chapter 9.</li><li><strong>352.24 Bends — How Made:</strong> Bends shall be made by methods that do not damage the conduit. Field bends shall be made only with bending equipment identified for the purpose.</li><li><strong>352.26 Bends — Number in One Run:</strong> There shall not be more than the equivalent of four quarter bends (360 degrees total) between pull points.</li><li><strong>352.28 Trimming:</strong> All cut ends shall be trimmed inside and outside to remove rough edges.</li><li><strong>352.30 Securing and Supporting:</strong> PVC conduit shall be installed as a complete system as provided in 300.18 and shall be secured and supported in accordance with this section.</li><li><strong>352.44 Expansion Fittings:</strong> Expansion fittings for PVC conduit shall be provided to compensate for thermal expansion and contraction where the length change is expected to be 6 mm (1⁄4 in.) or greater in a straight run.</li><li><strong>352.46 Bushings:</strong> Where a conduit enters a box, fitting, or other enclosure, a bushing or adapter shall be provided to protect the wire from abrasion unless the box, fitting, or enclosure design provides equivalent protection.</li><li><strong>352.48 Joints:</strong> All joints between lengths of conduit, and between conduit and couplings, fittings, and boxes, shall be made by an approved method.</li><li><strong>352.56 Splices and Taps:</strong> Splices and taps shall be made in accordance with 300.15.</li><li><strong>352.60 Grounding:</strong> Where equipment grounding is required, a separate equipment grounding conductor shall be installed in the conduit.</li></ul>"
        },
        {
            "article_number": "404",
            "title": "Switches",
            "summary": "Requirements for installation and use of switches",
            "content": "<h3>Article 404: Switches</h3><p>This article covers the requirements for switches, including installation, ratings, and applications for various types of switches.</p><h4>Key Provisions:</h4><ul><li><strong>404.1 Scope:</strong> This article covers requirements for switches, switching devices, and circuit breakers used as switches.</li><li><strong>404.2 Switch Connections:</strong> Requirements for switch connections, including rules for connection to the grounded (neutral) conductor.</li><li><strong>404.3 Enclosure:</strong> Switches and circuit breakers shall be of the externally operable type mounted in an enclosure listed for the intended use.</li><li><strong>404.4 Wet Locations:</strong> A switch or circuit breaker in a wet location shall be enclosed in a weatherproof enclosure or cabinet.</li><li><strong>404.6 Position and Connection of Switches:</strong> Requirements for the position and connection of switches, including multi-way switches.</li><li><strong>404.7 Indicating:</strong> General-use and motor-circuit switches, circuit breakers, and molded case switches shall clearly indicate whether they are in the open 'off' or closed 'on' position.</li><li><strong>404.8 Accessibility and Grouping:</strong> Requirements for the accessibility and grouping of switches, including height limitations.</li><li><strong>404.9 Provisions for General-Use Snap Switches:</strong> Requirements for faceplates, grounding, and boxes for general-use snap switches.</li><li><strong>404.10 Mounting of Snap Switches:</strong> Snap switches mounted in boxes shall have faceplates installed so as to completely cover the opening and seat against the finished surface.</li><li><strong>404.11 Circuit Breakers as Switches:</strong> Circuit breakers used as switches in 120-volt and 277-volt fluorescent lighting circuits shall be listed and shall be marked SWD or HID.</li><li><strong>404.12 Grounding of Enclosures:</strong> Metal enclosures for switches or circuit breakers shall be connected to an equipment grounding conductor.</li><li><strong>404.13 Knife Switches:</strong> Requirements for knife switches, including mounting, connection, and use.</li><li><strong>404.14 Rating and Use of Snap Switches:</strong> Requirements for the rating and use of snap switches for various applications.</li><li><strong>404.15 Marking:</strong> Switches shall be marked with the current, voltage, and, if horsepower rated, the maximum rating for which they are designed.</li><li><strong>404.16 600-Volt Knife Switches:</strong> Requirements for knife switches rated over 600 volts.</li><li><strong>404.17 Fused Switches:</strong> Requirements for fused switches, which shall have the fuses connected on the load side.</li><li><strong>404.18 Wire-Bending Space:</strong> The wire-bending space at the supply terminals of switches and at the supply and load terminals of circuit breakers shall be as required in Article 312.6.</li></ul>"
        },
        {
            "article_number": "406",
            "title": "Receptacles, Cord Connectors, and Attachment Plugs (Caps)",
            "summary": "Requirements for receptacles, cord connectors, and attachment plugs",
            "content": "<h3>Article 406: Receptacles, Cord Connectors, and Attachment Plugs (Caps)</h3><p>This article covers the installation and use of all receptacles, cord connectors, and attachment plugs (cord caps).</p><h4>Key Provisions:</h4><ul><li><strong>406.1 Scope:</strong> This article covers the rating, type, and installation of receptacles, cord connectors, and attachment plugs (cord caps).</li><li><strong>406.2 Definition:</strong> Provides definitions for terms used within this article.</li><li><strong>406.3 Receptacle Rating and Type:</strong> Requirements for receptacle ratings and types, including requirements for nongrounding-type receptacles.</li><li><strong>406.4 General Installation Requirements:</strong> Requirements for replacing receptacles, including grounding requirements for existing installations.</li><li><strong>406.5 Receptacle Mounting:</strong> Receptacles shall be mounted in identified boxes or assemblies designed for the purpose.</li><li><strong>406.6 Receptacle Faceplates (Cover Plates):</strong> Requirements for receptacle faceplates, including metal faceplates shall be of ferrous metal not less than 0.76 mm (0.030 in.) in thickness or of nonferrous metal not less than 1.02 mm (0.040 in.) in thickness.</li><li><strong>406.7 Attachment Plugs, Cord Connectors, and Flanged Surface Devices:</strong> All attachment plugs, cord connectors, and flanged surface devices (inlets and outlets) shall be listed and marked with the manufacturer's name or identification and voltage and ampere ratings.</li><li><strong>406.8 Receptacles in Damp or Wet Locations:</strong> Requirements for receptacles in damp or wet locations, including the use of weatherproof covers.</li><li><strong>406.9 Grounding-Type Receptacles, Adapters, Cord Connectors, and Attachment Plugs:</strong> Requirements for grounding-type receptacles, including design and connection requirements.</li><li><strong>406.10 Connecting Receptacle Grounding Terminal to Box:</strong> The connection of the receptacle grounding terminal shall comply with specified provisions.</li><li><strong>406.12 Tamper-Resistant Receptacles:</strong> Requirements for tamper-resistant receptacles in dwelling units, guest rooms and guest suites of hotels and motels, child care facilities, and other specified locations.</li><li><strong>406.13 Tamper-Resistant Receptacles in Guest Rooms and Guest Suites:</strong> Requirements for tamper-resistant receptacles in hotel and motel guest rooms and suites.</li><li><strong>406.14 Tamper-Resistant Receptacles in Child Care Facilities:</strong> Requirements for tamper-resistant receptacles in child care facilities.</li><li><strong>406.15 Dimmer-Controlled Receptacles:</strong> A receptacle supplying lighting loads shall not be connected to a dimmer unless the plug/receptacle combination is a nonstandard configuration type that is specifically listed and identified for each such unique combination.</li></ul>"
        },
        {
            "article_number": "422",
            "title": "Appliances",
            "summary": "Requirements for electric appliances",
            "content": "<h3>Article 422: Appliances</h3><p>This article covers electric appliances used in any occupancy, including installation requirements, branch circuits, and disconnecting means.</p><h4>Key Provisions:</h4><ul><li><strong>422.1 Scope:</strong> This article covers electric appliances used in any occupancy.</li><li><strong>422.5 Ground-Fault Circuit-Interrupter (GFCI) Protection:</strong> Defines when GFCI protection is required for appliances.</li><li><strong>422.6 Listing Required:</strong> All appliances shall be listed unless otherwise permitted in 422.6(A) or (B).</li><li><strong>422.10 Branch-Circuit Rating:</strong> This section specifies the branch-circuit rating for appliances.</li><li><strong>422.11 Overcurrent Protection:</strong> Appliances shall be protected against overcurrent in accordance with this section.</li><li><strong>422.12 Central Heating Equipment:</strong> Central heating equipment other than fixed electric space-heating equipment shall be supplied by an individual branch circuit.</li><li><strong>422.13 Storage-Type Water Heaters:</strong> A branch circuit supplying a fixed storage-type water heater with a capacity of 450 L (120 gal) or less shall have a rating not less than 125 percent of the nameplate rating of the water heater.</li><li><strong>422.16 Flexible Cords:</strong> Conditions under which flexible cords are permitted for connection of appliances.</li><li><strong>422.17 Protection of Combustible Material:</strong> Appliances that may present a fire hazard shall be installed to provide clearances from combustible materials.</li><li><strong>422.18 Support of Ceiling-Suspended (Paddle) Fans:</strong> Ceiling-suspended (paddle) fans shall be supported independently of an outlet box or by a listed outlet box or outlet box system identified for the use and installed in accordance with 314.27(C).</li><li><strong>422.20 Other Installation Methods:</strong> Appliances using other installation methods shall be installed in accordance with the related articles.</li><li><strong>422.30 General:</strong> A means shall be provided to disconnect each appliance from all ungrounded conductors in accordance with the following sections.</li><li><strong>422.31 Disconnection of Permanently Connected Appliances:</strong> Requirements for disconnection of permanently connected appliances rated at not over 300 volt-amperes or 1⁄8 horsepower.</li><li><strong>422.33 Disconnection of Cord-and-Plug-Connected Appliances:</strong> Requirements for disconnection of cord-and-plug-connected appliances.</li><li><strong>422.41 Cord-and-Plug-Connected Appliances Subject to Immersion:</strong> Cord-and-plug-connected portable, freestanding hydromassage units and hand-held hair dryers shall be constructed to provide protection for personnel against electrocution when immersed while in the 'on' or 'off' position.</li><li><strong>422.49 High-Pressure Spray Washers:</strong> All single-phase cord-and-plug-connected high-pressure spray washing machines rated at 250 volts or less shall be provided with factory-installed GFCI protection for personnel that is an integral part of the attachment plug or that is located in the supply cord not more than 300 mm (12 in.) from the attachment plug.</li><li><strong>422.50 Cord-and-Plug-Connected Pipe Heating Assemblies:</strong> Heating assemblies are permitted to be cord-and-plug connected provided certain conditions are met.</li><li><strong>422.51 Vending Machines:</strong> Cord-and-plug-connected vending machines shall have GFCI protection for personnel.</li><li><strong>422.52 Electric Drinking Fountains:</strong> Electric drinking fountains shall be protected with GFCI protection for personnel.</li></ul>"
        },
        {
            "article_number": "430",
            "title": "Motors, Motor Circuits, and Controllers",
            "summary": "Requirements for motors, motor branch-circuit and feeder conductors and their protection",
            "content": "<h3>Article 430: Motors, Motor Circuits, and Controllers</h3><p>This article covers motors, motor branch-circuit and feeder conductors and their protection, motor overload protection, motor control circuits, motor controllers, and motor control centers.</p><h4>Key Provisions:</h4><ul><li><strong>430.1 Scope:</strong> This article covers motors, motor branch-circuit and feeder conductors and their protection, motor overload protection, motor control circuits, motor controllers, and motor control centers.</li><li><strong>430.6 Ampacity and Motor Rating Determination:</strong> Requirements for determining motor and circuit ampacity ratings.</li><li><strong>430.7 Marking on Motors and Multimotor Equipment:</strong> Requirements for motor markings, including horsepower rating, voltage, and full-load amperes.</li><li><strong>430.8 Marking on Controllers:</strong> Requirements for controller markings.</li><li><strong>430.9 Terminals:</strong> Requirements for motor and controller terminals and leads.</li><li><strong>430.10 Wiring Space in Enclosures:</strong> Requirements for wiring space in motor controller enclosures.</li><li><strong>430.14 Location of Motors:</strong> Motors shall be located to provide adequate ventilation and maintenance.</li><li><strong>430.16 Exposure to Dust Accumulations:</strong> Motors with integral ventilation systems shall be located to minimize the accumulation of dust in the ventilation system.</li><li><strong>430.17 Highest Rated or Smallest Rated Motor:</strong> In determining compliance with some requirements of this article, the highest rated or smallest rated motor, as appropriate, with the exception of leakage current motors, shall be considered.</li><li><strong>430.22 Single Motor:</strong> Requirements for branch-circuit conductors supplying a single motor.</li><li><strong>430.24 Several Motors or a Motor(s) and Other Load(s):</strong> Requirements for branch-circuit conductors supplying several motors or a motor(s) and other load(s).</li><li><strong>430.32 Continuous-Duty Motors:</strong> Requirements for overload protection for continuous-duty motors.</li><li><strong>430.52 Rating or Setting for Individual Motor Circuit:</strong> Requirements for the rating or setting of the branch-circuit short-circuit and ground-fault protective device for individual motor circuits.</li><li><strong>430.53 Several Motors or Loads on One Branch Circuit:</strong> Requirements for group installation of motors on a single branch circuit.</li><li><strong>430.72 Overcurrent Protection for Motor Control Circuits:</strong> Requirements for overcurrent protection for motor control circuits.</li><li><strong>430.81 General:</strong> Part VII of this article covers motor controllers, including both those for starting and stopping motors and those for protecting motors.</li><li><strong>430.82 Controller Design:</strong> Requirements for controller design, including ratings, voltage, and motor type compatibility.</li><li><strong>430.83 Ratings:</strong> Requirements for controller ratings.</li><li><strong>430.94 Overcurrent Protection:</strong> Requirements for overcurrent protection of motor control centers.</li><li><strong>430.97 Busbars and Conductors:</strong> Requirements for busbars and conductors in motor control centers.</li><li><strong>430.102 Location:</strong> Requirements for the location of motor disconnect means.</li><li><strong>430.109 Type:</strong> Requirements for the type of disconnect means for motors.</li><li><strong>430.126 Adjustable-Speed Drive Systems:</strong> Requirements for adjustable-speed drive systems.</li></ul>"
        },
        {
            "article_number": "700",
            "title": "Emergency Systems",
            "summary": "Requirements for emergency systems that provide illumination or power upon loss of normal power supply",
            "content": "<h3>Article 700: Emergency Systems</h3><p>This article applies to the electrical safety of the installation, operation, and maintenance of emergency systems consisting of circuits and equipment intended to supply, distribute, and control electricity for illumination or power, or both, to required facilities when the normal electrical supply or system is interrupted.</p><h4>Key Provisions:</h4><ul><li><strong>700.1 Scope:</strong> This article applies to the electrical safety of the installation, operation, and maintenance of emergency systems.</li><li><strong>700.2 Definitions:</strong> Provides definitions for terms used in this article, including emergency systems, branches of an emergency system, relay automatic transfer switch, and more.</li><li><strong>700.3 Tests and Maintenance:</strong> Requirements for testing and maintaining emergency systems, including the requirement for an initial acceptance test and regular testing.</li><li><strong>700.4 Capacity:</strong> Emergency systems shall have adequate capacity and rating for all loads to be operated simultaneously.</li><li><strong>700.5 Transfer Equipment:</strong> Requirements for transfer equipment, including automatic transfer switches, which must be electrically operated and mechanically held.</li><li><strong>700.6 Signals:</strong> Audible and visual signal requirements for emergency systems, indicating when the normal power supply has failed or when batteries are below minimum voltage.</li><li><strong>700.7 Signs:</strong> Requirements for signs to identify emergency system components.</li><li><strong>700.8 Surge Protection:</strong> A listed SPD shall be installed in or on all emergency systems switchboards and panelboards.</li><li><strong>700.10 Wiring, Emergency System:</strong> Requirements for wiring emergency systems, including separation from other wiring and fire protection for emergency feeders.</li><li><strong>700.12 General Requirements:</strong> Requirements for emergency power sources, including generators, batteries, UPS systems, and separate services.</li><li><strong>700.15 Loads on Emergency Branch Circuits:</strong> No appliances and no other equipment shall be connected to the emergency branch circuits, except those directly related to the emergency system.</li><li><strong>700.16 Emergency Illumination:</strong> Requirements for emergency illumination, including minimum duration, automatic operation, and battery-powered emergency lights.</li><li><strong>700.17 Branch Circuits for Emergency Lighting:</strong> Branch circuits that supply emergency lighting shall be installed to provide service from a source complying with 700.12 when the normal supply to normal lighting is interrupted.</li><li><strong>700.18 Circuits for Emergency Power:</strong> For branch circuits that supply equipment classified as emergency, there shall be an emergency supply source to which the load will be transferred automatically upon the failure of the normal supply.</li><li><strong>700.19 Multiwire Branch Circuits:</strong> Multiwire branch circuits shall not be permitted in emergency systems.</li><li><strong>700.20 Switch Requirements:</strong> Emergency lighting systems shall be designed so that the failure of any individual lighting element, such as a lamp, cannot leave the area in darkness.</li><li><strong>700.25 Branch Circuit Emergency Lighting Transfer Switch:</strong> Requirements for emergency lighting transfer switches for branch circuits, which must be listed for emergency systems.</li><li><strong>700.26 Ground-Fault Protection of Equipment:</strong> The alternate source for emergency systems shall not be required to have ground-fault protection of equipment with automatic disconnecting means.</li><li><strong>700.27 Selective Coordination:</strong> Emergency system(s) overcurrent devices shall be selectively coordinated with all supply-side overcurrent protective devices.</li></ul>"
        }
    ]
    
    # Track statistics
    added_count = 0
    updated_count = 0
    skipped_count = 0
    
    try:
        # Process each article
        for article_data in updated_articles:
            # Check if article exists
            existing_article = NECArticle.query.filter_by(
                article_number=article_data['article_number']
            ).first()
            
            if existing_article:
                # Update existing article
                existing_article.title = article_data['title']
                existing_article.summary = article_data['summary']
                existing_article.content = article_data['content']
                updated_count += 1
                print(f"Updated Article {article_data['article_number']}: {article_data['title']}")
            else:
                # Create new article
                new_article = NECArticle(
                    article_number=article_data['article_number'],
                    title=article_data['title'],
                    summary=article_data['summary'],
                    content=article_data['content']
                )
                db.session.add(new_article)
                added_count += 1
                print(f"Added Article {article_data['article_number']}: {article_data['title']}")
        
        # Commit changes
        db.session.commit()
        
        print(f"\nNEC Article Update Summary (Batch 3):")
        print(f"Articles added: {added_count}")
        print(f"Articles updated: {updated_count}")
        print(f"Articles skipped: {skipped_count}")
        print(f"Total processed: {added_count + updated_count + skipped_count}")
        
        return True
        
    except Exception as e:
        db.session.rollback()
        print(f"Error updating NEC articles: {str(e)}")
        return False

def main():
    """Create app context and run the update function."""
    try:
        app = create_app()
        with app.app_context():
            success = update_nec_articles_batch3()
            if success:
                print("NEC article update (batch 3) completed successfully.")
            else:
                print("NEC article update (batch 3) failed.")
    except Exception as e:
        print(f"Error: {str(e)}")

if __name__ == "__main__":
    main() 